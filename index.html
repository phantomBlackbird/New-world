<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mobile 3D Game - Smaller Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.10.1/nipplejs.min.js"></script>

    <style>
      #joystick-zone {
        position: absolute;
        bottom: 40px;
        left: 40px;
        width: 120px;
        height: 120px;
        z-index: 10;
        /* Simple visual cue for the touch area */
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
      }
    </style>
  </head>
  <body>
    <div id="joystick-zone"></div>

    <a-scene renderer="antialias: true; colorManagement: true;">
      <a-assets>
        <a-asset-item id="world-glb" src="Subrural.glb"></a-asset-item>
        <a-asset-item id="floor-glb" src="Ground.glb"></a-asset-item>
        <a-asset-item id="player-glb" src="Player.glb"></a-asset-item>
      </a-assets>

      <a-entity gltf-model="#world-glb"></a-entity>
      <a-entity gltf-model="#floor-glb"></a-entity>

      <a-entity id="rig" position="0 0 0">
        <a-entity id="player"
                  gltf-model="#player-glb"
                  scale="0.15 0.15 0.15" 
                  position="0 0 0"
                  rotation="0 180 0"
                  animation-mixer="clip: idle; crossFadeDuration: 0.3">
        </a-entity>
        
        <a-entity camera position="0 0.8 1.9" rotation="-10 0 0"></a-entity>
      </a-entity>

      <a-light type="ambient" intensity="0.7"></a-light>
      <a-light type="directional" position="1 1 1"></a-light>
    </a-scene>

    <script>
      const rig = document.querySelector('#rig');
      const player = document.querySelector('#player');
      let isMoving = false;

      const manager = nipplejs.create({
        zone: document.getElementById('joystick-zone'),
        mode: 'static',
        position: {left: '60px', bottom: '60px'},
        color: 'cyan'
      });

      manager.on('move', (evt, data) => {
        if (!data.vector) return;

        if (!isMoving) {
          player.setAttribute('animation-mixer', 'clip: run-forward');
          isMoving = true;
        }

        // Speed adjusted for a smaller character scale
        const speed = 0.05; 
        const forward = data.vector.y;
        const side = data.vector.x;

        rig.object3D.position.x += side * speed;
        rig.object3D.position.z -= forward * speed;

        const angle = Math.atan2(side, forward);
        player.object3D.rotation.y = angle + Math.PI; 
      });

      manager.on('end', () => {
        player.setAttribute('animation-mixer', 'clip: idle');
        isMoving = false;
      });
    </script>
  </body>
</html>
